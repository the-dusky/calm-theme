{%- layout none -%}
  <script>
    console.log("THE COLLECTIONS", collections)
  </script>
{%- assign filtered_collections = collections | where: 'metafields.custom.shipping_date' -%}
[
{%- for collection in filtered_collections -%}
  {
    "id": {{ collection.id | json }},
    "handle": {{ collection.handle | json }},
    "title": {{ collection.title | json }},
    "shipping_date": {{ collection.metafields.custom.shipping_date | json }},
    "url": {{ collection.url | json }},
    "products_count": {{ collection.products_count | json }}
  }
  {%- unless forloop.last -%},{%- endunless -%}
{%- endfor -%}
{%- unless(filtered_collections) -%}
  {
    "error": true
  }
{%- endunless -%}
]